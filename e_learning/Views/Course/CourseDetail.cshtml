

@{
    ViewBag.Title = "CourseDetail";
    Layout = "~/Views/Shared/_Layout_Student.cshtml";

    var CourseVideo = ViewBag.CourseVideo as e_learning.Models.CourseVideo;

    bool isTrial = Model.IsTrialAvailable == true; // Oracle lưu bool là 1/0
}

@model Data_Oracle.Entities.Course

@section Styles{
    <link href="~/Content/Assets/template03/css/flaticon.css" rel="stylesheet" />
    <link href="~/Content/Assets/template03/css/style.css" rel="stylesheet" />
    <link href="~/Content/Assets/template03/css/slicknav.min.css" rel="stylesheet" />
    <link href="~/Content/Assets/template03/css/owl.carousel.min.css" rel="stylesheet" />
    <link href="~/Content/Assets/template03/css/magnific-popup.css" rel="stylesheet" />
    <link href="~/Content/Assets/template03/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/Content/Assets/template03/css/barfiller.css" rel="stylesheet" />

    <link href="~/Content/Assets/template03/css/css1.css" rel="stylesheet" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">


}

@section Scripts{
    @* jQuery PHẢI được tải đầu tiên *@
    <script src="~/Content/Assets/template03/js/jquery-3.3.1.min.js"></script>

    @* Các script khác tải sau *@
    <script src="~/Content/Assets/template03/js/bootstrap.min.js"></script>
    <script src="~/Content/Assets/template03/js/jquery.barfiller.js"></script>
    <script src="~/Content/Assets/template03/js/jquery.magnific-popup.min.js"></script>
    <script src="~/Content/Assets/template03/js/jquery.slicknav.js"></script>
    <script src="~/Content/Assets/template03/js/masonry.pkgd.min.js"></script>
    @*<script src="~/Content/Assets/template03/js/main3.js"></script>*@
    <script src="~/Content/Assets/template03/js/owl.carousel.min.js"></script>

    <script src="~/Content/Assets/template03/js/jquery-3.3.1.min.js"></script>
    <script src="~/Content/Assets/template03/js/bootstrap.min.js"></script>
    <script>
     $(document).ready(function() {
         console.log("Document ready!"); // Kiểm tra xem JS có chạy không

         // Sự kiện nút Đăng ký ngay
         $('.btn-register-trigger').click(function(e) {
             e.preventDefault();
             console.log("Button clicked!"); // Debug
             $('#enrollModal').modal('show');
         });

         // Xử lý nút Dùng thử
         $('#btnJoinTrial').click(function() {
             var btn = $(this);
             btn.prop('disabled', true).text('Đang xử lý...');

             $.post('@Url.Action("JoinFreeTrial", "Course")', { courseId: @Model.CourseID }, function(res) {
                 if(res.success) {
                     window.location.href = res.redirectUrl;
                 } else {
                     alert(res.message);
                     btn.prop('disabled', false).text('Thử lại');
                 }
             });
         });
     });
    </script>

}

<section class="spad">
    <div class="container">
        <div class="row">

            <div class="col-lg-8">
                <div class="class-details-text">

                    <div class="cd-pic mb-4">
                        <img src="~/Content/Assets/images/courses/@Model.Image" alt="@Model.CourseName" class="img-fluid rounded-3">
                    </div>

                    <div class="cd-single-item mb-4">
                        <h3 class="mb-3">@Model.CourseName</h3>
                        <p style="color:black">
                            @Model.Description
                        </p>
                    </div>

                    <hr class="my-4">

                    <div class="cd-course-highlights">
                        <h4 class="mb-3">Bạn sẽ học được gì?</h4>
                        <ul class="list-group list-group-flush">
                            @foreach (var z in CourseVideo.Chapters)
                            {
                                <li class="list-group-item"><i class="fa fa-check-circle" style="color: #007bff; margin-right: 8px;"></i>@z.ChapterComplated</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">

                <div class="course-sidebar mb-4 p-4">
                    <h3 class="fw-bold mb-1"> @String.Format("{0:#,##0} VND", Model.Price)</h3>
                    <p class="text-muted mb-3">Ưu đãi trọn đời</p>

                    <a href="javascript:void(0)" class="btn btn-primary btn-lg w-100 mb-4 shadow-sm btn-register-trigger">
                        Đăng ký ngay
                    </a>

                    <hr class="my-4">

                    <h5 class="fw-bold mb-3">Về khóa học</h5>
                    <ul class="list-unstyled mb-4 course-features">
                        <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span><i class="bi bi-mortarboard me-2 text-info"></i>Trình độ</span>
                            <span class="fw-bold">@CourseVideo.CourcesVideoLevel</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span><i class="bi bi-clock me-2 text-warning"></i>Thời lượng</span>
                            <span class="fw-bold">@CourseVideo.CourcesVideoDuration</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span><i class="bi bi-star-fill me-2 text-danger"></i>Đánh giá</span>
                            <span class="fw-bold">4.8 / 5</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span><i class="bi bi-people me-2 text-success"></i>Học viên</span>
                            <span class="fw-bold">@CourseVideo.NumberOfStudent</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span><i class="bi bi-play-circle me-2 text-primary"></i>Bài học</span>
                            <span class="fw-bold">@CourseVideo.NumberOfLession</span>
                        </li>
                        <li class="d-flex justify-content-between align-items-center py-2">
                            <span><i class="bi bi-award me-2 text-warning"></i>Chứng chỉ</span>
                            <span class="fw-bold">@Model.Certificate</span>
                        </li>
                    </ul>

                    <hr class="my-4">

                    <h5 class="fw-bold mb-3">Giảng viên</h5>
                    <div class="d-flex align-items-center">
                        <img src="~/Content/Assets/template03/img/classes/class-details/trainer-profile.jpg" alt="Athart Rachel"
                             class="img-fluid rounded-circle me-3"
                             style="width: 70px; height: 70px; object-fit: cover;">
                        <div>
                            <h6 class="fw-bold mb-0">Athart Rachel</h6>
                            <span class="text-muted">Giảng viên chính</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="row-12">
            <div class="col-12">
                <div class="syllabus-section mt-5">
                    <h4 class="mb-3">Nội dung khóa học</h4>

                    <div class="coursera-container">

                        @foreach (var x in CourseVideo.Chapters)
                        {
                            <div class="course-item">
                                <div class="course-summary">
                                    <div class="d-flex align-items-start">
                                        @*<div class="course-thumbnail"></div>*@
                                        <div class="course-info">
                                            <a href="#" class="course-title">@x.ChapterName</a>
                                            <p class="course-meta"></p>
                                        </div>
                                    </div>
                                    <a href="#content-course-@x.ChapterID"
                                       data-bs-toggle="collapse"
                                       class="course-details-link collapsed">
                                        Course details <i class="bi bi-chevron-down"></i>
                                    </a>
                                </div>
                                <div class="course-content-expanded collapse" id="content-course-@x.ChapterID">
                                    <h6 class="content-heading">What you'll learn</h6>

                                    @foreach (var y in x.Lessions)
                                    {
                                        <ul class="what-you-learn-list">

                                            <li><i class="bi bi-check"></i>@y.LessionDecription</li>

                                        </ul>

                                    }
                                    <h6 class="content-heading">Skills you'll gain</h6>

                                    <div class="skills-container">
                                        @foreach (var y in x.Lessions)
                                        {
                                            <span class="skill-tag">@y.LessionComplate</span>
                                        }
                                    </div>


                                </div>
                            </div>
                        }

                        <div class="certificate-box">
                            <i class="bi bi-patch-check-fill certificate-icon"></i>
                            <div class="certificate-info">
                                <h5>Earn a career certificate</h5>
                                <p>Add this credential to your LinkedIn profile, resume, or CV. Share it on social media and in your performance review.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<div id="enrollModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content shadow-lg border-0">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-cart-check"></i> Xác nhận đăng ký
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body p-4 text-center">
                <h4 class="mb-3 text-primary fw-bold">@Model.CourseName</h4>

                <div class="price-tag mb-4">
                    <span class="text-muted text-decoration-line-through me-2">@(Model.Price * 1.2) VND</span>
                    <span class="display-6 fw-bold text-danger">@String.Format("{0:#,##0} VND", Model.Price)</span>
                </div>

                <p class="text-muted mb-4">
                    Bạn sẽ nhận được quyền truy cập trọn đời, chứng chỉ hoàn thành và hỗ trợ từ giảng viên.
                </p>

                <form action="@Url.Action("BuyNow", "Course", new {courseId = Model.CourseID})" method="post" id="formBuyNow">
                    <input type="hidden" name="courseId" value="@Model.CourseID" />
                    <button type="submit" class="btn btn-success btn-lg w-100 py-3 mb-3 fw-bold shadow-sm">
                        <i class="bi bi-credit-card-2-front"></i> THANH TOÁN NGAY
                    </button>
                </form>

                @if (isTrial)
                {
                    <div class="separator my-3 text-muted">HOẶC</div>
                    <button type="button" id="btnJoinTrial" class="btn btn-outline-secondary w-100">
                        <i class="bi bi-journal-bookmark"></i> Dùng thử miễn phí (Chapter 1)
                    </button>
                }
            </div>

        </div>
    </div>
</div>
